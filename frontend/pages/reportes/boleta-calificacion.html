<!DOCTYPE html>

<html lang="en" class="light-style layout-menu-fixed" dir="ltr" data-theme="theme-default" data-assets-path="../assets/"
  data-template="vertical-menu-template-free">

<head>
  <meta charset="utf-8" />
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

  <title>Calificaciones</title>

  <meta name="description" content="" />
  <!-- Logo en la pestaña -->
  <link rel="icon" type="image/x-icon" href="/frontend/assets/img/LogoEscuela.png" />

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
    rel="stylesheet" />

  <!-- Material Symbols -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.1/locales/es.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.js.iife.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/driver.js@1.0.1/dist/driver.css" />
  <!-- CSS -->
  <link rel="stylesheet" href="../../assets/css/core.css" class="template-customizer-core-css" />
  <link rel="stylesheet" href="../../assets/css/theme-default.css" class="template-customizer-theme-css" />
  <link rel="stylesheet" href="../../assets/css/sidebar.css" />
  <!-- Scroll CSS -->

  <!-- Helpers -->
  
  <!-- Estilos para la boleta de calificaciones -->
  <style>
    .boleta-container {
      width: 8.5in;
      height: 5.5in;
      background: white;
      border: 2px solid #000;
      padding: 0.4in;
      font-family: Arial, sans-serif;
      font-size: 11px;
      line-height: 1.1;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .boleta-header {
      display: flex;
      align-items: flex-start;
      margin-bottom: 20px;
      position: relative;
    }

    .boleta-logo {
      width: 60px;
      height: 60px;
      border: 2px solid #333;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      padding: 5px;
      overflow: hidden;
      position: absolute;
      top: 0;
      left: 0;
    }

    .boleta-logo .logo-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
    }

    .boleta-title-section {
      flex: 1;
      margin-left: 80px;
      text-align: center;
    }

    .boleta-school-name {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
      text-transform: uppercase;
      line-height: 1.2;
    }

    .boleta-main-title {
      font-size: 18px;
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
      text-transform: uppercase;
    }

    .boleta-table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      flex-shrink: 0;
    }

    .boleta-table th,
    .boleta-table td {
      border: 1px solid #000;
      padding: 6px;
      text-align: center;
      vertical-align: middle;
    }

    .boleta-table th {
      background-color: #f0f0f0;
      font-weight: bold;
    }

    .boleta-table .area-column {
      text-align: left;
      width: 40%;
    }

    .boleta-table .unidad-column {
      width: 12%;
    }

    .boleta-table .final-column {
      width: 12%;
    }

    .boleta-footer {
      display: flex;
      justify-content: space-between;
      margin-top: auto;
      padding-top: 10px;
    }

    .boleta-footer-left {
      flex: 1;
    }

    .boleta-footer-right {
      flex: 1;
      text-align: right;
    }

    .boleta-signature-line {
      border-bottom: 1px solid #000;
      margin-top: 5px;
      height: 20px;
    }

    .boleta-seal {
      margin-top: 20px;
      font-weight: bold;
    }

    @media print {
      .boleta-container {
        width: 8.5in;
        height: 5.5in;
        margin: 0;
        padding: 0.5in;
        box-shadow: none;
        border: none;
      }
      
      body * {
        visibility: hidden;
      }
      
      .boleta-container, .boleta-container * {
        visibility: visible;
      }
      
      .boleta-container {
        position: absolute;
        left: 0;
        top: 0;
      }
    }

    /* Estilos para vista previa */
    #vistaPreviaContainer .boleta-container {
      transform: scale(0.6);
      transform-origin: top center;
    }

    /* Estilos para dos boletas por hoja */
    .boleta-doble-container {
      width: 8.5in;
      height: 11in;
      background: white;
      padding: 0.5in;
      font-family: Arial, sans-serif;
      font-size: 12px;
      line-height: 1.2;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 0.5in;
    }

    .boleta-doble-container .boleta-container {
      width: 100%;
      height: 5.2in;
      border: 1px solid #ccc;
      padding: 0.3in;
      margin: 0;
      box-shadow: none;
      display: flex;
      flex-direction: column;
    }

    .boleta-doble-container .boleta-container:first-child {
      border-bottom: 2px solid #333;
    }

    /* Estilos para impresión de dos boletas */
    @media print {
      .boleta-doble-container {
        width: 8.5in;
        height: 11in;
        margin: 0;
        padding: 0.5in;
        box-shadow: none;
        border: none;
      }
      
      .boleta-doble-container .boleta-container {
        width: 100%;
        height: 5in;
        padding: 0.3in;
        margin: 0;
        box-shadow: none;
        border: 1px solid #ccc;
      }
      
      body * {
        visibility: hidden;
      }
      
      .boleta-doble-container, .boleta-doble-container * {
        visibility: visible;
      }
      
      .boleta-doble-container {
        position: absolute;
        left: 0;
        top: 0;
      }
    }
  </style>
</head>

<body>

  <!-- Layout -->
  <div class="layout-wrapper layout-content-navbar" id="mainContainer">

    <!-- Botón hamburguesa para móvil (oculto en desktop) -->
    <button id="menuToggleMobile" class="hamburger-btn d-xl-none">
      <img src="../../assets/img/LogoEscuela.png" alt="Logo EORM Linda Vista" class="hamburger-img">
    </button>

    <div class="layout-container">

      <!-- Menu -->
      <aside class="layout-menu menu-vertical bg-menu-theme" id="layoutMenu">
        <div class="app-brand demo">
          <a href="../../pages/dashboard.html" class="app-brand-link">
            <span class="app-brand-logo demo">
              <img src="../../assets/img/LogoEscuela.png" alt="Logo EORM Linda Vista" width="70" height="70">
            </span>
            <span class="app-brand-text demo menu-text fw-bolder ms-2 text-uppercase">EORM</span>
          </a>

          <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto d-block d-xl-none"
            id="closeMenu">
            <span class="material-symbols-outlined">close</span>
          </a>
        </div>

        <!-- Señala la pestaña activa -->
        <div class="menu-inner-shadow"></div>
        <ul class="menu-inner py-1">

          <!-- Dashboard/Inicio -->
          <li class="menu-item">
            <a href="../../pages/dashboard.html" class="menu-link">
              <span class="menu-icon material-symbols-outlined">home</span>
              <div class="menu-text" data-i18n="Analytics">Inicio</div>
            </a>
          </li>

          <!-- Modulo de Tareas -->
          <li class="menu-item" id="menuTareas">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <span class="menu-icon material-symbols-outlined">assignment</span>
              <div class="menu-text" data-i18n="Layouts">Tareas</div>
            </a>

            <ul class="menu-sub">
              <li class="menu-item">
                <a href="../../pages/tareas/calendario.html" class="menu-link">
                  <div data-i18n="Without menu">Calendario</div>
                </a>
              </li>
              <li class="menu-item ">
                <a href="../../pages/tareas/actividades.html" class="menu-link">
                  <div data-i18n="Without navbar">Actividades</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="../../pages/tareas/asigna-lista-cotejo.html" class="menu-link">
                  <div data-i18n="Container">Visualizar Lista de Cotejo</div>
                </a>
              </li>
            </ul>
          </li>

          <!-- Información del alumno -->
          <li class="menu-item">
            <a href="../../pages/alumnos/alumnos.html" class="menu-link">
              <span class="menu-icon material-symbols-outlined">group</span>
              <div class="menu-text" data-i18n="Documentation">Alumnos</div>
            </a>
          </li>

          <!-- Modulo de Reportes -->
          <li class="menu-item" id="menuReportes">
            <a href="javascript:void(0);" class="menu-link menu-toggle">
              <span class="menu-icon material-symbols-outlined">summarize</span>
              <div class="menu-text" data-i18n="Layouts">Reportes</div>
            </a>

            <ul class="menu-sub">
              <li class="menu-item active">
                <a href="../../pages/reportes/boleta-calificacion.html" class="menu-link">
                  <div data-i18n="Without menu">Boleta de Calificaciones</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="../../pages/reportes/lista-cotejo.html" class="menu-link">
                  <div data-i18n="Without navbar">Lista de Cotejo</div>
                </a>
              </li>
              <li class="menu-item">
                <a href="../../pages/reportes/cuadro-prim.html" class="menu-link">
                  <div data-i18n="Container">Cuadro PRIM</div>
                </a>
              </li>
            </ul>
          </li>

          <li class="menu-item">
            <a href="../../pages/alertas/alertas.html" class="menu-link">
              <span class="menu-icon material-symbols-outlined">notification_important</span>
              <div class="menu-text" data-i18n="Documentation">Alertas</div>
            </a>
          </li>

          <li class="menu-item">
            <a href="../../pages/panelControl/panel-control.html" class="menu-link">
              <span class="menu-icon material-symbols-outlined">settings</span>
              <div class="menu-text" data-i18n="Documentation">Panel de control</div>
            </a>
          </li>

          <li class="menu-item">
            <a href="../../pages/maestros/maestros.html" class="menu-link">
              <span class="menu-icon material-symbols-outlined">person</span>
              <div class="menu-text" data-i18n="Documentation">Maestros</div>
            </a>
          </li>
        </ul>
      </aside>

      <!-- Layout container -->
      <div class="layout-page">
        <!-- Navbar -->

        <nav
          class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
          id="layout-navbar">

          <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">

            <ul class="navbar-nav flex-row align-items-center ms-auto">
              <!-- Place this tag where you want the button to render. -->

              <span class="fw-semibold d-block">Perfil de Usuario</span>
              <!-- User -->
              <li class="nav-item navbar-dropdown dropdown-user dropdown">
                <a class="nav-link dropdown-toggle hide-arrow" href="javascript:void(0);" data-bs-toggle="dropdown">
                  <div class="avatar avatar-online">
                    <img src="../../assets/img/icons/user.png" alt class="w-px-40 h-auto rounded-circle" />
                  </div>
                </a>
                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item" href="../../pages/perfil.html">
                      <div class="d-flex">
                        <div class="flex-shrink-0 me-3">
                          <div class="avatar avatar-online">
                            <img src="../../assets/img/icons/user.png" alt class="w-px-40 h-auto rounded-circle" />
                          </div>
                        </div>
                        <div class="flex-grow-1">
                          <span class="fw-semibold d-block">Carolay Canté</span>
                          <small class="text-muted">Docente</small>
                        </div>
                      </div>
                    </a>
                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="../../pages/perfil.html">
                      <i class="bx bx-user me-2"></i>
                      <span class="align-middle">Mi Perfil</span>
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="#">
                      <i class="bx bx-cog me-2"></i>
                      <span class="align-middle">Configuraciones</span>
                    </a>
                  </li>
                  <li>

                  </li>
                  <li>
                    <div class="dropdown-divider"></div>
                  </li>
                  <li>
                    <a class="dropdown-item" href="../../index.html">
                      <i class="bx bx-power-off me-2"></i>
                      <span class="align-middle">Cerrar Sesión</span>
                    </a>
                  </li>
                </ul>
              </li>
              <!--/ User -->
            </ul>
          </div>
        </nav>

        <!-- Content wrapper -->
        <div class="content-wrapper">
          <!-- Mensaje Bienvenida -->
          <div class="container-xxl flex-grow-1 container-p-y">
            <div class="row mb-4">
              <div class="col-lg-12 order-0">
                <div class="card">
                  <div class="card-body py-3">
                    <h2 class="card-title text-primary mb-2">Reporte Boleta de calificaciones</h2>
                    <p class="mb-0">
                      Enseñar es un trabajo que se hace desde el corazón!
                    </p>
                  </div>
                </div>
              </div>
              <!-- Total Revenue -->
            </div>

            <!-- Controles para generar boleta -->
            <div class="col-lg-12 mb-3">
              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">
                    Generar Boleta de Calificaciones
                  </h6>
                </div>
                <div class="card-body">
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Tipo de impresión:</label>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipoImpresion" id="estudianteEspecifico" value="especifico" checked>
                        <label class="form-check-label" for="estudianteEspecifico">
                          Estudiante específico
                        </label>
                      </div>
                      <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipoImpresion" id="todosEstudiantes" value="todos">
                        <label class="form-check-label" for="todosEstudiantes">
                          Todos los estudiantes
                        </label>
                      </div>
                    </div>
                    <div class="col-md-6" id="selectAlumnoContainer">
                      <label for="selectAlumno" class="form-label">Alumno:</label>
                      <select class="form-select" id="selectAlumno">
                        <option value="">Seleccionar alumno</option>
                      </select>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-12">
                      <button type="button" class="btn btn-primary" id="btnGenerarBoleta">
                        <i class="material-symbols-outlined me-2">print</i>
                        <span id="btnText">Generar Boleta</span>
                      </button>
                      <button type="button" class="btn btn-success ms-2" id="btnVistaPrevia">
                        <i class="material-symbols-outlined me-2">visibility</i>
                        Vista Previa
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Vista previa de la boleta -->
            <div class="col-lg-12 mb-3" id="vistaPreviaContainer" style="display: none;">
              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">
                    Vista Previa - Boleta de Calificaciones
                  </h6>
                </div>
                <div class="card-body">
                  <div class="d-flex justify-content-center">
                    <div id="boletaContainer" class="boleta-container">
                      <!-- La boleta se generará aquí -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>


        </div>
        <!-- / Content -->

        <!-- Footer -->
        <footer class="content-footer footer bg-footer-theme">
          <div class="container-xxl d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
            <div class="mb-2 mb-md-0">
              Carolay Canté © 2026, "Construyendo herramientas que facilitan el aprendizaje."
            </div>
            <div>
              <a href="https://themeselection.com/demo/sneat-bootstrap-html-admin-template/documentation/"
                target="_blank" class="footer-link me-4">Documentación</a>
            </div>
          </div>
        </footer>
        <!-- / Footer -->

        <div class="content-backdrop fade"></div>
      </div>
    </div>
    <!-- / Layout page -->
  </div>
  <!-- Overlay -->
  <div class="layout-overlay layout-menu-toggle"></div>
  </div>
  <!-- / Layout wrapper -->
  <!-- Core JS -->
  <script src="../../assets/js/bootstrap.js"></script>
  <!-- endbuild -->
  <!-- Main JS -->
  <script src="/frontend/assets/js/main.js"></script>
  <!-- JS Geovanny-->
  <script src="../../assets/js/Calendar/index.global.min.js"></script>
  <script src="../../assets/js/Menu/sidebar.js"></script>

  <!-- Script para la boleta de calificaciones -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // Datos de ejemplo - estos vendrán del backend
    const materiasPorGrado = {
      1: [
        "Comunicación y Lenguaje",
        "Matemáticas", 
        "Medio Natural y Social",
        "Expresión Artística",
        "Educación Física",
        "Formación Ciudadana"
      ],
      2: [
        "Comunicación y Lenguaje",
        "Matemáticas",
        "Medio Natural y Social", 
        "Expresión Artística",
        "Educación Física",
        "Formación Ciudadana"
      ],
      3: [
        "Comunicación y Lenguaje",
        "Matemáticas",
        "Medio Natural y Social",
        "Expresión Artística", 
        "Educación Física",
        "Formación Ciudadana"
      ],
      4: [
        "Comunicación y Lenguaje",
        "Matemáticas",
        "Medio Natural y Social",
        "Expresión Artística",
        "Educación Física", 
        "Formación Ciudadana"
      ],
      5: [
        "Comunicación y Lenguaje",
        "Matemáticas",
        "Medio Natural y Social",
        "Expresión Artística",
        "Educación Física",
        "Formación Ciudadana"
      ],
      6: [
        "Comunicación y Lenguaje",
        "Matemáticas",
        "Medio Natural y Social",
        "Expresión Artística",
        "Educación Física",
        "Formación Ciudadana"
      ]
    };

    // Datos de ejemplo de estudiantes - estos vendrán del backend
    const estudiantesEjemplo = [
      {
        id: 1,
        nombre: "Juan Pérez García",
        grado: "1",
        calificaciones: {
          "Comunicación y Lenguaje": { unidad1: 85, unidad2: 90, unidad3: 88, unidad4: 92, final: 89 },
          "Matemáticas": { unidad1: 78, unidad2: 82, unidad3: 85, unidad4: 88, final: 83 },
          "Medio Natural y Social": { unidad1: 90, unidad2: 87, unidad3: 91, unidad4: 89, final: 89 },
          "Expresión Artística": { unidad1: 88, unidad2: 85, unidad3: 90, unidad4: 87, final: 88 },
          "Educación Física": { unidad1: 92, unidad2: 89, unidad3: 91, unidad4: 90, final: 91 },
          "Formación Ciudadana": { unidad1: 85, unidad2: 88, unidad3: 86, unidad4: 89, final: 87 }
        }
      },
      {
        id: 2,
        nombre: "María López Rodríguez",
        grado: "2",
        calificaciones: {
          "Comunicación y Lenguaje": { unidad1: 92, unidad2: 88, unidad3: 90, unidad4: 91, final: 90 },
          "Matemáticas": { unidad1: 85, unidad2: 89, unidad3: 87, unidad4: 90, final: 88 },
          "Medio Natural y Social": { unidad1: 88, unidad2: 91, unidad3: 89, unidad4: 92, final: 90 },
          "Expresión Artística": { unidad1: 90, unidad2: 87, unidad3: 89, unidad4: 88, final: 89 },
          "Educación Física": { unidad1: 89, unidad2: 92, unidad3: 88, unidad4: 91, final: 90 },
          "Formación Ciudadana": { unidad1: 87, unidad2: 90, unidad3: 88, unidad4: 89, final: 89 }
        }
      },
      {
        id: 3,
        nombre: "Carlos Hernández Martínez",
        grado: "3",
        calificaciones: {
          "Comunicación y Lenguaje": { unidad1: 80, unidad2: 85, unidad3: 82, unidad4: 87, final: 84 },
          "Matemáticas": { unidad1: 75, unidad2: 80, unidad3: 78, unidad4: 83, final: 79 },
          "Medio Natural y Social": { unidad1: 88, unidad2: 85, unidad3: 90, unidad4: 87, final: 88 },
          "Expresión Artística": { unidad1: 85, unidad2: 82, unidad3: 87, unidad4: 84, final: 85 },
          "Educación Física": { unidad1: 90, unidad2: 87, unidad3: 89, unidad4: 88, final: 89 },
          "Formación Ciudadana": { unidad1: 83, unidad2: 86, unidad3: 84, unidad4: 87, final: 85 }
        }
      },
      {
        id: 4,
        nombre: "Ana García Sánchez",
        grado: "4",
        calificaciones: {
          "Comunicación y Lenguaje": { unidad1: 95, unidad2: 92, unidad3: 94, unidad4: 93, final: 94 },
          "Matemáticas": { unidad1: 90, unidad2: 93, unidad3: 91, unidad4: 94, final: 92 },
          "Medio Natural y Social": { unidad1: 93, unidad2: 95, unidad3: 92, unidad4: 94, final: 94 },
          "Expresión Artística": { unidad1: 92, unidad2: 90, unidad3: 94, unidad4: 91, final: 92 },
          "Educación Física": { unidad1: 94, unidad2: 91, unidad3: 93, unidad4: 92, final: 93 },
          "Formación Ciudadana": { unidad1: 91, unidad2: 94, unidad3: 92, unidad4: 93, final: 93 }
        }
      },
      {
        id: 5,
        nombre: "Luis Rodríguez Pérez",
        grado: "5",
        calificaciones: {
          "Comunicación y Lenguaje": { unidad1: 87, unidad2: 90, unidad3: 88, unidad4: 91, final: 89 },
          "Matemáticas": { unidad1: 82, unidad2: 85, unidad3: 84, unidad4: 87, final: 85 },
          "Medio Natural y Social": { unidad1: 89, unidad2: 87, unidad3: 91, unidad4: 88, final: 89 },
          "Expresión Artística": { unidad1: 86, unidad2: 89, unidad3: 87, unidad4: 90, final: 88 },
          "Educación Física": { unidad1: 91, unidad2: 88, unidad3: 90, unidad4: 89, final: 90 },
          "Formación Ciudadana": { unidad1: 88, unidad2: 91, unidad3: 89, unidad4: 90, final: 90 }
        }
      }
    ];

    // Función para generar la boleta individual
    function generarBoletaIndividual(datosAlumno) {
      const {
        nombreAlumno = "NOMBRE DEL ALUMNO",
        grado = "1",
        calificaciones = {},
        observaciones = "",
        nombreMaestro = "NOMBRE DEL MAESTRO",
        nombreDirector = "NOMBRE DEL DIRECTOR"
      } = datosAlumno;

      const materias = materiasPorGrado[grado] || materiasPorGrado[1];
      
      let tablaMaterias = '';
      materias.forEach(materia => {
        const calif = calificaciones[materia] || {};
        tablaMaterias += `
          <tr>
            <td class="area-column">${materia}</td>
            <td class="unidad-column">${calif.unidad1 || ''}</td>
            <td class="unidad-column">${calif.unidad2 || ''}</td>
            <td class="unidad-column">${calif.unidad3 || ''}</td>
            <td class="unidad-column">${calif.unidad4 || ''}</td>
            <td class="final-column">${calif.final || ''}</td>
          </tr>
        `;
      });

      // Calcular promedio
      const promedios = materias.map(materia => {
        const calif = calificaciones[materia] || {};
        const valores = [calif.unidad1, calif.unidad2, calif.unidad3, calif.unidad4].filter(v => v && !isNaN(v));
        return valores.length > 0 ? (valores.reduce((a, b) => a + b, 0) / valores.length).toFixed(1) : '';
      });
      
      const promedioGeneral = promedios.filter(p => p).length > 0 
        ? (promedios.filter(p => p).reduce((a, b) => a + parseFloat(b), 0) / promedios.filter(p => p).length).toFixed(1)
        : '';

      return `
        <div class="boleta-container">
          <!-- Header -->
          <div class="boleta-header">
            <div class="boleta-logo">
              <img src="/frontend/assets/img/LogoEscuela.png" alt="Logo Escuela" class="logo-image">
            </div>
            <div class="boleta-title-section">
              <div class="boleta-school-name">ESCUELA OFICIAL RURAL MIXTA COLONIA LINDA VISTA</div>
            </div>
          </div>

          <!-- Título principal -->
          <div class="boleta-main-title">RESUMEN DE AVANCE DE LOS APRENDIZAJES</div>

          <!-- Información del alumno -->
          <div style="margin: 15px 0; font-weight: bold;">
            <div>Alumno: ${nombreAlumno}</div>
            <div>Grado: ${grado}°</div>
          </div>

          <!-- Tabla de calificaciones -->
          <table class="boleta-table">
            <thead>
              <tr>
                <th class="area-column">AREAS CURRICULARES</th>
                <th colspan="4" style="text-align: center;">UNIDADES</th>
                <th class="final-column">NOTA FINAL</th>
              </tr>
              <tr>
                <th class="area-column"></th>
                <th class="unidad-column">1</th>
                <th class="unidad-column">2</th>
                <th class="unidad-column">3</th>
                <th class="unidad-column">4</th>
                <th class="final-column"></th>
              </tr>
            </thead>
            <tbody>
              ${tablaMaterias}
              <tr>
                <td class="area-column"><strong>PROMEDIO</strong></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="final-column"><strong>${promedioGeneral}</strong></td>
              </tr>
            </tbody>
          </table>

          <!-- Footer -->
          <div class="boleta-footer">
            <div class="boleta-footer-left">
              <div style="margin-top: 20px;"><strong>FIRMA DE MAESTRO:</strong></div>
              <div class="boleta-signature-line"></div>
              <div style="margin-top: 15px;"><strong>FIRMA DE DIRECTOR:</strong></div>
              <div class="boleta-signature-line"></div>
            </div>
            <div class="boleta-footer-right">
              <div class="boleta-seal">SELLO</div>
            </div>
          </div>
        </div>
      `;
    }

    // Función para generar boleta con datos completos
    function generarBoleta(datosAlumno) {
      return generarBoletaIndividual(datosAlumno);
    }

    // Función para generar página con dos boletas
    function generarPaginaDoble(estudiante1, estudiante2) {
      const boleta1 = generarBoletaIndividualConFecha(estudiante1);
      const boleta2 = estudiante2 ? generarBoletaIndividualConFecha(estudiante2) : '';
      
      return `
        <div class="boleta-doble-container">
          ${boleta1}
          ${boleta2}
        </div>
      `;
    }

    // Función para generar boleta individual con fecha y firmas lado a lado
    function generarBoletaIndividualConFecha(datosAlumno) {
      const {
        nombreAlumno = "NOMBRE DEL ALUMNO",
        grado = "1",
        calificaciones = {},
        observaciones = "",
        nombreMaestro = "NOMBRE DEL MAESTRO",
        nombreDirector = "NOMBRE DEL DIRECTOR"
      } = datosAlumno;

      const materias = materiasPorGrado[grado] || materiasPorGrado[1];
      
      let tablaMaterias = '';
      materias.forEach(materia => {
        const calif = calificaciones[materia] || {};
        tablaMaterias += `
          <tr>
            <td class="area-column">${materia}</td>
            <td class="unidad-column">${calif.unidad1 || ''}</td>
            <td class="unidad-column">${calif.unidad2 || ''}</td>
            <td class="unidad-column">${calif.unidad3 || ''}</td>
            <td class="unidad-column">${calif.unidad4 || ''}</td>
            <td class="final-column">${calif.final || ''}</td>
          </tr>
        `;
      });

      // Calcular promedio
      const promedios = materias.map(materia => {
        const calif = calificaciones[materia] || {};
        const valores = [calif.unidad1, calif.unidad2, calif.unidad3, calif.unidad4].filter(v => v && !isNaN(v));
        return valores.length > 0 ? (valores.reduce((a, b) => a + b, 0) / valores.length).toFixed(1) : '';
      });
      
      const promedioGeneral = promedios.filter(p => p).length > 0 
        ? (promedios.filter(p => p).reduce((a, b) => a + parseFloat(b), 0) / promedios.filter(p => p).length).toFixed(1)
        : '';

      // Obtener fecha actual
      const fecha = new Date().toLocaleDateString('es-GT');

      return `
        <div class="boleta-container">
          <!-- Header -->
          <div class="boleta-header">
            <div class="boleta-logo">
              <img src="/frontend/assets/img/LogoEscuela.png" alt="Logo Escuela" class="logo-image">
            </div>
            <div class="boleta-title-section">
              <div class="boleta-school-name">ESCUELA OFICIAL RURAL MIXTA COLONIA LINDA VISTA</div>
            </div>
          </div>

          <!-- Título principal -->
          <div class="boleta-main-title">RESUMEN DE AVANCE DE LOS APRENDIZAJES</div>


          <!-- Información del alumno -->
          <div style="margin: 15px 0; font-weight: bold;">
            <div>Alumno: ${nombreAlumno}</div>
            <div>Grado: ${grado}°</div>
          </div>

          <!-- Tabla de calificaciones -->
          <table class="boleta-table">
            <thead>
              <tr>
                <th class="area-column">AREAS CURRICULARES</th>
                <th colspan="4" style="text-align: center;">UNIDADES</th>
                <th class="final-column">NOTA FINAL</th>
              </tr>
              <tr>
                <th class="area-column"></th>
                <th class="unidad-column">1</th>
                <th class="unidad-column">2</th>
                <th class="unidad-column">3</th>
                <th class="unidad-column">4</th>
                <th class="final-column"></th>
              </tr>
            </thead>
            <tbody>
              ${tablaMaterias}
              <tr>
                <td class="area-column"><strong>PROMEDIO</strong></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="unidad-column"></td>
                <td class="final-column"><strong>${promedioGeneral}</strong></td>
              </tr>
            </tbody>
          </table>

          <!-- Footer -->
          <div class="boleta-footer">
            <div class="boleta-footer-left">
              <div class="boleta-signature-section">
                <div><strong>FIRMA DE MAESTRO:</strong></div>
                <div class="boleta-signature-line"></div>
              </div>
              <div class="boleta-signature-section">
                <div><strong>FIRMA DE DIRECTOR:</strong></div>
                <div class="boleta-signature-line"></div>
              </div>
            </div>
            <div class="boleta-footer-right">
              <div class="boleta-seal">SELLO</div>
            </div>
          </div>
        </div>
      `;
    }

    // Función para mostrar vista previa
    function mostrarVistaPrevia() {
      const tipoImpresion = document.querySelector('input[name="tipoImpresion"]:checked').value;
      const alumno = document.getElementById('selectAlumno').value;

      if (tipoImpresion === 'especifico' && !alumno) {
        alert('Por favor seleccione un alumno');
        return;
      }

      let boletaHTML = '';

      if (tipoImpresion === 'especifico') {
        // Vista previa de un estudiante específico
        const estudiante = estudiantesEjemplo.find(e => e.nombre === alumno);
        if (estudiante) {
          const datosAlumno = {
            ...estudiante,
            observaciones: "Alumno con buen rendimiento académico",
            nombreMaestro: "Prof. María González",
            nombreDirector: "Lic. Carlos Pérez"
          };
          boletaHTML = generarBoleta(datosAlumno);
        }
      } else {
        // Vista previa de todos los estudiantes (mostrar solo los primeros 2)
        const estudiantes = estudiantesEjemplo.slice(0, 2);
        boletaHTML = generarPaginaDoble(estudiantes[0], estudiantes[1]);
      }

      document.getElementById('boletaContainer').innerHTML = boletaHTML;
      document.getElementById('vistaPreviaContainer').style.display = 'block';
    }

    // Función para imprimir boleta individual
    function imprimirBoletaIndividual(estudiante) {
      const datosAlumno = {
        ...estudiante,
        observaciones: "Alumno con buen rendimiento académico",
        nombreMaestro: "Prof. María González",
        nombreDirector: "Lic. Carlos Pérez"
      };

      const boletaHTML = generarBoleta(datosAlumno);
      
      // Crear ventana de impresión
      const ventanaImpresion = window.open('', '_blank');
      ventanaImpresion.document.write(`
        <html>
          <head>
            <title>Boleta de Calificaciones - ${estudiante.nombre}</title>
            <style>
              body { margin: 0; padding: 0; }
              .boleta-container {
                width: 8.5in;
                height: 5.5in;
                background: white;
                padding: 0.4in;
                font-family: Arial, sans-serif;
                font-size: 11px;
                line-height: 1.1;
                display: flex;
                flex-direction: column;
                border: 2px solid #000;
                position: relative;
              }
              .boleta-header {
                display: flex;
                align-items: flex-start;
                margin-bottom: 20px;
                position: relative;
              }
              .boleta-logo {
                width: 60px;
                height: 60px;
                border: 2px solid #333;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 15px;
                padding: 5px;
                overflow: hidden;
                position: absolute;
                top: 0;
                left: 0;
              }
              .boleta-logo .logo-image {
                width: 100%;
                height: 100%;
                object-fit: contain;
                border-radius: 50%;
              }
              .boleta-title-section {
                flex: 1;
                margin-left: 80px;
                text-align: center;
              }
              .boleta-school-name {
                font-size: 14px;
                font-weight: bold;
                margin-bottom: 5px;
                text-transform: uppercase;
                line-height: 1.2;
              }
              .boleta-main-title {
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                margin-top: 10px;
                text-transform: uppercase;
              }
              .boleta-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                flex-shrink: 0;
              }
              .boleta-table th,
              .boleta-table td {
                border: 1px solid #000;
                padding: 6px;
                text-align: center;
                vertical-align: middle;
              }
              .boleta-table th {
                background-color: #f0f0f0;
                font-weight: bold;
              }
              .boleta-table .area-column {
                text-align: left;
                width: 40%;
              }
              .boleta-table .unidad-column {
                width: 12%;
              }
              .boleta-table .final-column {
                width: 12%;
              }
              .boleta-footer {
                display: flex;
                justify-content: space-between;
                margin-top: auto;
                padding-top: 10px;
              }
              .boleta-footer-left {
                flex: 1;
                display: flex;
                gap: 30px;
              }
              .boleta-footer-right {
                flex: 1;
                text-align: right;
              }
              .boleta-signature-section {
                flex: 1;
              }
              .boleta-signature-line {
                border-bottom: 1px solid #000;
                margin-top: 5px;
                height: 20px;
                width: 100%;
              }
              .boleta-seal {
                margin-top: 20px;
                font-weight: bold;
              }
            </style>
          </head>
          <body>
            ${boletaHTML}
          </body>
        </html>
      `);
      ventanaImpresion.document.close();
      ventanaImpresion.print();
    }

    // Función para generar un solo PDF con todas las boletas
    async function generarPDFTodasBoletas() {
      // Agrupar estudiantes de 2 en 2 para las páginas
      const paginas = [];
      for (let i = 0; i < estudiantesEjemplo.length; i += 2) {
        const estudiante1 = estudiantesEjemplo[i];
        const estudiante2 = estudiantesEjemplo[i + 1];
        paginas.push({ estudiante1, estudiante2, numero: Math.floor(i / 2) + 1 });
      }

      // Generar HTML completo con todas las páginas
      let htmlCompleto = `
        <!DOCTYPE html>
        <html>
          <head>
            <title>Boletas de Calificaciones</title>
            <meta charset="utf-8">
            <style>
              body { 
                margin: 0; 
                padding: 0; 
                font-family: Arial, sans-serif;
                background: white;
              }
              .boleta-doble-container {
                width: 8.5in;
                height: 11in;
                background: white;
                padding: 0.5in;
                font-family: Arial, sans-serif;
                font-size: 11px;
                line-height: 1.1;
                display: flex;
                flex-direction: column;
                gap: 0.5in;
                box-sizing: border-box;
                page-break-after: always;
                border: 2px solid #000;
                position: relative;
              }
              .boleta-doble-container:last-child {
                page-break-after: avoid;
              }
              .boleta-doble-container .boleta-container {
                width: 100%;
                height: 5.2in;
                border: 1px solid #ccc;
                padding: 0.3in;
                margin: 0;
                box-shadow: none;
                display: flex;
                flex-direction: column;
                box-sizing: border-box;
              }
              .boleta-doble-container .boleta-container:first-child {
                border-bottom: 2px solid #333;
              }
              .boleta-header {
                display: flex;
                align-items: flex-start;
                margin-bottom: 15px;
                position: relative;
              }
              .boleta-logo {
                width: 60px;
                height: 60px;
                border: 2px solid #333;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 15px;
                padding: 5px;
                overflow: hidden;
                flex-shrink: 0;
                position: absolute;
                top: 0;
                left: 0;
              }
              .boleta-logo .logo-image {
                width: 100%;
                height: 100%;
                object-fit: contain;
                border-radius: 50%;
              }
              .boleta-title-section {
                flex: 1;
                margin-left: 80px;
                text-align: center;
              }
              .boleta-school-name {
                font-size: 14px;
                font-weight: bold;
                margin-bottom: 5px;
                text-transform: uppercase;
                line-height: 1.2;
              }
              .boleta-main-title {
                font-size: 18px;
                font-weight: bold;
                text-align: center;
                margin-top: 10px;
                text-transform: uppercase;
              }
              .boleta-table {
                width: 100%;
                border-collapse: collapse;
                margin: 15px 0;
                flex-shrink: 0;
              }
              .boleta-table th,
              .boleta-table td {
                border: 1px solid #000;
                padding: 6px;
                text-align: center;
                vertical-align: middle;
              }
              .boleta-table th {
                background-color: #f0f0f0;
                font-weight: bold;
              }
              .boleta-table .area-column {
                text-align: left;
                width: 40%;
              }
              .boleta-table .unidad-column {
                width: 12%;
              }
              .boleta-table .final-column {
                width: 12%;
              }
              .boleta-footer {
                display: flex;
                justify-content: space-between;
                margin-top: auto;
                padding-top: 10px;
              }
              .boleta-footer-left {
                flex: 1;
                display: flex;
                gap: 30px;
              }
              .boleta-footer-right {
                flex: 1;
                text-align: right;
              }
              .boleta-signature-section {
                flex: 1;
              }
              .boleta-signature-line {
                border-bottom: 1px solid #000;
                margin-top: 5px;
                height: 20px;
                width: 100%;
              }
              .boleta-seal {
                margin-top: 20px;
                font-weight: bold;
              }
              @media print {
                body { 
                  margin: 0; 
                  padding: 0; 
                  background: white;
                }
                .boleta-doble-container {
                  width: 8.5in;
                  height: 11in;
                  margin: 0;
                  padding: 0.5in;
                  box-shadow: none;
                  border: none;
                  page-break-after: always;
                }
                .boleta-doble-container:last-child {
                  page-break-after: avoid;
                }
                .boleta-doble-container .boleta-container {
                  width: 100%;
                  height: 5.2in;
                  padding: 0.3in;
                  margin: 0;
                  box-shadow: none;
                  border: 1px solid #ccc;
                }
              }
            </style>
          </head>
          <body>
      `;

      // Agregar cada página al HTML
      paginas.forEach(pagina => {
        const datosAlumno1 = {
          ...pagina.estudiante1,
          observaciones: "Alumno con buen rendimiento académico",
          nombreMaestro: "Prof. María González",
          nombreDirector: "Lic. Carlos Pérez"
        };

        const datosAlumno2 = pagina.estudiante2 ? {
          ...pagina.estudiante2,
          observaciones: "Alumno con buen rendimiento académico",
          nombreMaestro: "Prof. María González",
          nombreDirector: "Lic. Carlos Pérez"
        } : null;

        htmlCompleto += generarPaginaDoble(datosAlumno1, datosAlumno2);
      });

      htmlCompleto += `
          </body>
        </html>
      `;

      // Crear ventana de impresión
      const ventanaImpresion = window.open('', '_blank');
      ventanaImpresion.document.write(htmlCompleto);
      ventanaImpresion.document.close();
      ventanaImpresion.print();
    }

    // Función principal para imprimir
    function imprimirBoleta() {
      const tipoImpresion = document.querySelector('input[name="tipoImpresion"]:checked').value;
      const alumno = document.getElementById('selectAlumno').value;

      if (tipoImpresion === 'especifico') {
        if (!alumno) {
          alert('Por favor seleccione un alumno');
          return;
        }
        const estudiante = estudiantesEjemplo.find(e => e.nombre === alumno);
        if (estudiante) {
          imprimirBoletaIndividual(estudiante);
        }
      } else {
        // Generar un solo PDF con todas las boletas
        generarPDFTodasBoletas();
      }
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Cargar alumnos de ejemplo
      const selectAlumno = document.getElementById('selectAlumno');
      
      estudiantesEjemplo.forEach(estudiante => {
        const option = document.createElement('option');
        option.value = estudiante.nombre;
        option.textContent = estudiante.nombre;
        selectAlumno.appendChild(option);
      });

      // Event listeners para los botones
      document.getElementById('btnVistaPrevia').addEventListener('click', mostrarVistaPrevia);
      document.getElementById('btnGenerarBoleta').addEventListener('click', imprimirBoleta);

      // Event listeners para los radio buttons
      document.getElementById('estudianteEspecifico').addEventListener('change', function() {
        if (this.checked) {
          document.getElementById('selectAlumnoContainer').style.display = 'block';
          document.getElementById('btnText').textContent = 'Generar Boleta';
        }
      });

      document.getElementById('todosEstudiantes').addEventListener('change', function() {
        if (this.checked) {
          document.getElementById('selectAlumnoContainer').style.display = 'none';
          document.getElementById('btnText').textContent = 'Generar PDF con Todas las Boletas';
        }
      });
    });
  </script>

</body>

</html>